<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>1st Partial Exam - Econometrics II</title>
  <style>
    * {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    body {
      font-family: Helvetica, Arial, sans-serif;
      font-size: 11pt;
      line-height: 1.5;
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem;
      background: white;
    }

    #exam-content {
      transition: filter 0.1s ease;
    }

    #exam-content.blurred {
      filter: blur(15px);
    }

    h1 {
      text-align: center;
      font-size: 14pt;
      font-weight: bold;
      margin-bottom: 0.25rem;
    }

    h2 {
      text-align: center;
      font-size: 12pt;
      font-weight: normal;
      margin-top: 0;
      margin-bottom: 0.25rem;
    }

    .date {
      text-align: center;
      margin-bottom: 1.5rem;
    }

    .rules {
      margin-bottom: 2rem;
    }

    .rules p {
      margin-bottom: 0.5rem;
    }

    .rules ul {
      margin: 0;
      padding-left: 1.5rem;
    }

    .rules li {
      margin-bottom: 0.5rem;
    }

    .rules ul ul {
      margin-top: 0.5rem;
    }

    .exam-number {
      border: 1px solid black;
      padding: 0.5rem 1rem;
      display: inline-block;
      margin-top: 1rem;
    }

    .exam-number-label {
      font-size: 10pt;
    }

    .exam-number-value {
      font-size: 24pt;
      font-weight: bold;
    }

    .question {
      margin: 2rem 0;
      padding-top: 1rem;
      border-top: 1px solid black;
    }

    .question-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    .question-label {
      font-weight: bold;
    }

    .question-points {
      font-weight: bold;
    }

    .question p {
      margin: 0.75rem 0;
    }

    .question ol {
      margin: 0.75rem 0;
      padding-left: 1.5rem;
    }

    .question ol[type="a"] {
      list-style-type: lower-alpha;
    }

    .question li {
      margin-bottom: 0.5rem;
    }

    .formula {
      text-align: center;
      margin: 1rem 0;
      font-style: italic;
    }

    table {
      border-collapse: collapse;
      margin: 1rem 0;
    }

    table th, table td {
      border: 1px solid black;
      padding: 0.25rem 0.5rem;
      text-align: center;
      min-width: 2.5rem;
    }

    #overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.95);
      justify-content: center;
      align-items: center;
      z-index: 1000;
      flex-direction: column;
    }

    #overlay.visible {
      display: flex;
    }

    #overlay-message {
      font-size: 14pt;
      margin-bottom: 1.5rem;
      color: #333;
      text-align: center;
      max-width: 400px;
    }

    #unblur-btn {
      padding: 1rem 2rem;
      font-size: 12pt;
      font-family: Helvetica, Arial, sans-serif;
      background: white;
      color: black;
      border: 2px solid black;
      cursor: pointer;
    }

    #unblur-btn:hover {
      background: #f0f0f0;
    }

    #unblur-btn:disabled {
      background: #eee;
      color: #999;
      border-color: #999;
      cursor: not-allowed;
    }

    #status {
      position: fixed;
      top: 1rem;
      right: 1rem;
      padding: 0.5rem 1rem;
      background: white;
      border: 1px solid #4a4;
      color: #4a4;
      font-size: 10pt;
    }

    #status.warning {
      border-color: #a44;
      color: #a44;
    }

    #countdown {
      font-size: 12pt;
      margin-top: 1rem;
      color: #666;
    }
  </style>
</head>
<body>
  <div id="status">Loading...</div>

  <div id="exam-content" class="blurred">
    <h1>1st Partial Exam</h1>
    <h2>Econometrics II (Course No. 2534)</h2>
    <div class="date">November 20, 2025</div>

    <div class="rules">
      <p>Please be aware of the following <strong>rules</strong> for this exam:</p>
      <ul>
        <li>You have <strong>120 Minutes</strong> to answer the questions.</li>
        <li>You can receive up to <strong>30 points</strong>.</li>
        <li>There are 6 differently weighted questions in this exam. You should aim not to use more than 4 minutes per point. The order of questions is randomized and they can be answered independently.</li>
        <li>Your exam is marked with an ID number on every page. <strong>Please do neither write your name nor your student ID number anywhere on this exam</strong>, so that we can guarantee fairness and anonymity while grading. Name and exam number are matched on a separate attendance sheet.</li>
        <li>You are only allowed to answer the questions in <strong>English</strong>.</li>
        <li>The following <strong>aids</strong> are allowed:
          <ul>
            <li>A calculator.</li>
            <li>The cheat sheet that was created by your Cheat Sheet Group.</li>
            <li>Empty sheets for taking notes (which cannot be handed in).</li>
            <li>A bilingual dictionary (English and your native language).</li>
            <li>Coffee.</li>
          </ul>
        </li>
      </ul>
      <div class="exam-number">
        <span class="exam-number-label">Exam No.</span><br>
        <span class="exam-number-value">01</span>
      </div>
    </div>

    <div class="question">
      <div class="question-header">
        <span class="question-label">Question 1</span>
        <span class="question-points">3 Points</span>
      </div>
      <p>Assume you want to find out whether increased olive oil consumption leads to a longer life span, and if so, how large the effect is. For this, you collect data on the two variables and then use local polynomial regression, a non-parametric method. Is this a suitable workflow to answer the question at hand? Name <strong>two reasons</strong> why it is or is not.</p>
    </div>

    <div class="question">
      <div class="question-header">
        <span class="question-label">Question 2</span>
        <span class="question-points">3 Points</span>
      </div>
      <p>Imagine you conduct work on the question how education is related to wages. You collect data on the relevant variables and covariates, carefully construct a causal model, and run a regression. Afterwards, your friend Blobert comes over and says that he trained some advanced Machine Learning model on a large amount of data and it would outperform your model. Indeed, when you both remove the outcome variable from the datasets you collected and run a prediction competition, Blobert's predictions are more accurate than yours. Should you be worried? <strong>Explain</strong> why you should or should not be.</p>
    </div>

    <div class="question">
      <div class="question-header">
        <span class="question-label">Question 3</span>
        <span class="question-points">6 Points</span>
      </div>
      <p><strong>Draw</strong> a Directed Acyclic Graph (DAG) relating education and wages. The graph should include at least 8 nodes and 10 edges.</p>
      <ol type="a">
        <li><strong>Enumerate</strong> all <strong>paths</strong> from education to wage. <em>(2 points)</em></li>
        <li><strong>Name</strong> all confounders, colliders, and mediators in your model. <em>(2 points)</em></li>
        <li>Now think realistically and <strong>determine</strong> which variables would be <strong>unobserved</strong> in a real-life context. Mark them in the DAG and <strong>assess</strong> whether the causal effect of interest can still be identified. <em>(2 points)</em></li>
      </ol>
    </div>

    <div class="question">
      <div class="question-header">
        <span class="question-label">Question 4</span>
        <span class="question-points">6 Points</span>
      </div>
      <p>A team of researchers is interested in understanding the effect of eviction on individual income and health. To conduct the analysis, they plan to use available data from the United States.</p>
      <ol type="a">
        <li>Provide a simple <strong>regression equation</strong> that the team could use to answer their research question.</li>
        <li>In your opinion, what potential issues could arise that would invalidate the <strong>internal validity</strong> of their results?</li>
        <li>Do you believe that the results will be <strong>generalizable</strong>?</li>
      </ol>
    </div>

    <div class="question">
      <div class="question-header">
        <span class="question-label">Question 5</span>
        <span class="question-points">4 Points</span>
      </div>
      <p>You are told that the average treatment effect (ATE) equals 0.4 and the expected value of the untreated is 0.3. Treatment is balanced and there is appropriate overlap with respect to the covariates (G<sub>i</sub> and educ<sub>i</sub>), binary indicators for gender and completing education.</p>
      <ol type="a">
        <li><strong>Provide</strong> the formula through which the ATE has been found.</li>
        <li><strong>Fill in</strong> the columns X<sub>i</sub>, Y<sub>i</sub>, Y<sub>i</sub>(1), and Y<sub>i</sub>(0) so that your table is internally consistent and reproduces the stated ATE. Note that several answers can be correct.</li>
        <li>In the <strong>potential outcome framework</strong>, what is the main issue of researchers?</li>
      </ol>
      <table>
        <tr>
          <th><em>i</em></th>
          <th>G<sub>i</sub></th>
          <th>educ<sub>i</sub></th>
          <th>X<sub>i</sub></th>
          <th>Y<sub>i</sub></th>
          <th>Y<sub>i</sub>(1)</th>
          <th>Y<sub>i</sub>(0)</th>
        </tr>
        <tr><td>1</td><td>0</td><td>0</td><td></td><td></td><td></td><td></td></tr>
        <tr><td>2</td><td>0</td><td>1</td><td></td><td></td><td></td><td></td></tr>
        <tr><td>3</td><td>1</td><td>0</td><td></td><td></td><td></td><td></td></tr>
        <tr><td>4</td><td>1</td><td>1</td><td></td><td></td><td></td><td></td></tr>
        <tr><td>5</td><td>0</td><td>0</td><td></td><td></td><td></td><td></td></tr>
        <tr><td>6</td><td>0</td><td>1</td><td></td><td></td><td></td><td></td></tr>
        <tr><td>7</td><td>1</td><td>0</td><td></td><td></td><td></td><td></td></tr>
        <tr><td>8</td><td>1</td><td>1</td><td></td><td></td><td></td><td></td></tr>
        <tr><td>9</td><td>0</td><td>0</td><td></td><td></td><td></td><td></td></tr>
        <tr><td>10</td><td>0</td><td>1</td><td></td><td></td><td></td><td></td></tr>
        <tr><td>11</td><td>1</td><td>0</td><td></td><td></td><td></td><td></td></tr>
        <tr><td>12</td><td>1</td><td>1</td><td></td><td></td><td></td><td></td></tr>
      </table>
    </div>

    <div class="question">
      <div class="question-header">
        <span class="question-label">Question 6</span>
        <span class="question-points">6 Points</span>
      </div>
      <p>Consider the following labor <strong>supply</strong> and <strong>demand</strong> functions, both driven by the wage <em>w</em>:</p>
      <div class="formula">
        L<sub>s</sub> = α<sup>s</sup>w + u<sup>s</sup><br>
        L<sub>d</sub> = α<sup>d</sup>w + u<sup>d</sup>
      </div>
      <p>In labor economics, a question of interest has always been the impact of the wages on the demand of labor.</p>
      <ol type="a">
        <li>According to you, is it possible to estimate <strong>the effect of wage</strong> on the demand of labor? Why?</li>
        <li>Formally <strong>prove</strong> your answer in a.</li>
      </ol>
    </div>
  </div>

  <div id="overlay" class="visible">
    <div id="overlay-message">Loading exam...</div>
    <button id="unblur-btn" disabled>Please wait...</button>
    <div id="countdown"></div>
  </div>

  <script>
    // ========== CONFIGURATION ==========
    // Set these times in YOUR timezone (Europe/Vienna)
    // Format: 'YYYY-MM-DDTHH:MM:SS'
    const EXAM_START = '2026-01-01T00:00:00';  // Exam becomes available
    const EXAM_END = '2026-01-31T23:59:59';    // Exam closes
    const TIMEZONE = 'Europe/Vienna';
    // ===================================

    const examContent = document.getElementById('exam-content');
    const overlay = document.getElementById('overlay');
    const overlayMessage = document.getElementById('overlay-message');
    const unblurBtn = document.getElementById('unblur-btn');
    const status = document.getElementById('status');
    const countdownEl = document.getElementById('countdown');

    let examAvailable = false;
    let isMobileDevice = false;
    let mouseInWindow = false;

    // Detect mobile/tablet devices (iOS, iPadOS, Android)
    // Must allow macOS and other desktop operating systems
    function detectMobileDevice() {
      const ua = navigator.userAgent || navigator.vendor || window.opera;
      
      // Check for Android
      if (/android/i.test(ua)) {
        return true;
      }
      
      // Check for iOS (iPhone, iPod)
      if (/iPhone|iPod/.test(ua)) {
        return true;
      }
      
      // Check for iPad specifically
      // Modern iPadOS reports as Mac, so we need to check for touch support too
      if (/iPad/.test(ua)) {
        return true;
      }
      
      // Detect iPadOS 13+ which masquerades as macOS
      // It's a Mac user agent BUT has touch support AND is not actually macOS
      if (/Macintosh/.test(ua) && navigator.maxTouchPoints && navigator.maxTouchPoints > 1) {
        return true;
      }
      
      return false;
    }

    function blockMobileDevice() {
      isMobileDevice = true;
      examAvailable = false;
      overlayMessage.innerHTML = 'This exam cannot be taken on a mobile or tablet device.<br><br>Please use a desktop or laptop computer.';
      unblurBtn.style.display = 'none';
      countdownEl.textContent = '';
      status.textContent = 'Mobile device blocked';
      status.classList.add('warning');
    }
    let serverTimeOffset = 0; // Difference between server time and local time
    let mouseInWindow = false;

    // Fetch server time to prevent local clock manipulation
    async function getServerTime() {
      try {
        const response = await fetch('https://worldtimeapi.org/api/timezone/' + TIMEZONE);
        const data = await response.json();
        const serverTime = new Date(data.datetime);
        serverTimeOffset = serverTime.getTime() - Date.now();
        return serverTime;
      } catch (e) {
        console.warn('Could not fetch server time, using local time');
        return new Date();
      }
    }

    function getCurrentTime() {
      return new Date(Date.now() + serverTimeOffset);
    }

    function parseExamTime(timeStr) {
      // Parse the time string and treat it as being in the specified timezone
      // We create a date string that includes the timezone offset for Vienna
      const date = new Date(timeStr);
      // Get Vienna's offset for this date
      const viennaDate = new Date(date.toLocaleString('en-US', { timeZone: TIMEZONE }));
      const localDate = new Date(date.toLocaleString('en-US'));
      const offset = localDate - viennaDate;
      return new Date(date.getTime() + offset);
    }

    function formatTimeRemaining(ms) {
      if (ms < 0) return '';
      const hours = Math.floor(ms / (1000 * 60 * 60));
      const minutes = Math.floor((ms % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((ms % (1000 * 60)) / 1000);
      if (hours > 0) {
        return `${hours}h ${minutes}m ${seconds}s`;
      } else if (minutes > 0) {
        return `${minutes}m ${seconds}s`;
      } else {
        return `${seconds}s`;
      }
    }

    function checkExamAvailability() {
      // If mobile device, stay blocked regardless of time
      if (isMobileDevice) {
        return;
      }

      const now = getCurrentTime();
      const startTime = parseExamTime(EXAM_START);
      const endTime = parseExamTime(EXAM_END);

      if (now < startTime) {
        // Exam not started yet
        examAvailable = false;
        const remaining = startTime - now;
        overlayMessage.textContent = 'The exam has not started yet.';
        unblurBtn.disabled = true;
        unblurBtn.textContent = 'Please wait...';
        countdownEl.textContent = 'Starts in: ' + formatTimeRemaining(remaining);
        status.textContent = 'Not started';
        status.classList.add('warning');
      } else if (now > endTime) {
        // Exam ended
        examAvailable = false;
        overlayMessage.textContent = 'The exam has ended.';
        unblurBtn.disabled = true;
        unblurBtn.textContent = 'Exam closed';
        countdownEl.textContent = '';
        status.textContent = 'Exam ended';
        status.classList.add('warning');
      } else {
        // Exam is available
        examAvailable = true;
        const remaining = endTime - now;
        countdownEl.textContent = 'Time remaining: ' + formatTimeRemaining(remaining);
        
        if (overlay.classList.contains('visible')) {
          overlayMessage.textContent = 'Click to begin the exam';
          unblurBtn.disabled = false;
          unblurBtn.textContent = 'Click to Continue Exam';
        }
      }
    }

    function blurExam(reason) {
      examContent.classList.add('blurred');
      overlay.classList.add('visible');
      if (examAvailable) {
        overlayMessage.textContent = reason;
        unblurBtn.disabled = false;
        unblurBtn.textContent = 'Click to Continue Exam';
      }
      status.textContent = reason;
      status.classList.add('warning');
    }

    function unblurExam() {
      if (!examAvailable) return;
      if (!mouseInWindow) {
        blurExam('Move mouse into window first');
        return;
      }
      examContent.classList.remove('blurred');
      overlay.classList.remove('visible');
      status.textContent = 'Exam Active';
      status.classList.remove('warning');
    }

    // Click to unblur
    unblurBtn.addEventListener('click', unblurExam);

    // Blur on any keypress
    document.addEventListener('keydown', (e) => {
      if (examAvailable) {
        blurExam('Key pressed');
      }
      e.preventDefault();
    });

    // Blur when window loses focus
    window.addEventListener('blur', () => {
      if (examAvailable) {
        blurExam('Window inactive');
      }
    });

    // Blur when mouse leaves the document
    document.documentElement.addEventListener('mouseleave', () => {
      mouseInWindow = false;
      if (examAvailable) {
        blurExam('Mouse left window');
      }
    });

    // Also catch when mouse leaves body as backup
    document.body.addEventListener('mouseleave', () => {
      mouseInWindow = false;
      if (examAvailable) {
        blurExam('Mouse left window');
      }
    });

    // Track when mouse enters
    document.documentElement.addEventListener('mouseenter', () => {
      mouseInWindow = true;
    });

    // Disable right-click
    document.addEventListener('contextmenu', (e) => {
      e.preventDefault();
    });

    // Disable copy, cut, paste
    document.addEventListener('copy', (e) => e.preventDefault());
    document.addEventListener('cut', (e) => e.preventDefault());
    document.addEventListener('paste', (e) => e.preventDefault());

    // Disable drag
    document.addEventListener('dragstart', (e) => e.preventDefault());

    // Disable print
    window.addEventListener('beforeprint', () => {
      if (examAvailable) {
        blurExam('Print detected');
      }
    });

    // Initialize
    async function init() {
      // Check for mobile device first
      if (detectMobileDevice()) {
        blockMobileDevice();
        return; // Don't proceed with time checks
      }

      await getServerTime();
      checkExamAvailability();
      // Check availability every second
      setInterval(checkExamAvailability, 1000);
      // Re-sync server time every 5 minutes
      setInterval(getServerTime, 5 * 60 * 1000);
    }

    init();
  </script>
</body>
</html>
